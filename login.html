<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - TecWorld</title>
    <style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
        body, html { height: 100%; font-family: Arial, sans-serif; }
body {
  display: flex;  
  flex-direction: column;
  justify-content: center;
  align-items: center; 
  overflow: hidden; 
  text-align: center;
  margin: 0;


background-image: linear-gradient(to top, #0a1624 0%, #152e4d 50%, #204b80 100%);
  background-attachment: fixed;
  background-repeat: no-repeat;
  background-size: cover;
}

body::after {
  content: ''; 
  position: fixed;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 0, 0.45); /* levemente mais suave que a anterior */
  z-index: -1;
}


.language-buttons { 
            position: fixed; 
            top: 10px; 
            right: 10px; 
            z-index: 2; 
        }

        .language-buttons select { 
            padding: 5px 10px; 
            cursor: pointer; 
            background-color: #333; 
            color: #fff;
            border-radius: 5px;
        }


  .login-container {
    display: flex; 
    flex-direction: column; /* deixa em coluna */
    justify-content: center; 
    align-items: center; 
    height: 100%;
    z-index: 2;
}


    form.invisible
     { background-color: transparent;
         padding: 30px;
          box-shadow: none;
           border-radius: 0;
            width: 350px;
             text-align: center;
             }
    h1
     { font-size: 39px;
         margin-bottom:29px;
           color: #ffffff; /* branco puro */
 
         }
    input
    [type="text"],
     input[type="password"]
      { width: 100%;
         padding: 14px;
          margin: 10px 0;
           border: 1px solid #b3dae4;
            border-radius: 8px;
             background-color: #8ed2e4;
              color: #ffffff;
               font-size: 18px;
             }
    input[type="text"]::placeholder,
     input[type="password"]::placeholder
      { color: #000;
     }
    .login-btn
     { width: 100%;
         padding: 14px;
          background:
            linear-gradient(to right, #00bfff, #0077ff);
           border: none; 
           border-radius: 8px; 
           color: white; 
           font-size: 18px; 
           cursor: pointer; 
           margin-top: 20px; 
           transition: 0.3s; 
       background: linear-gradient(to right, #00cfff, #005eff);
    box-shadow: 0 0 15px rgba(0, 191, 255, 0.8), 
                0 0 30px rgba(0, 119, 255, 0.6);
        transform: scale(1.05); 
    }
    .forgot-password, .create-account, .back-to-login 
    { display: block;
         margin-top: 20px;
          font-size: 14px;
           color: #00ffd9;
            text-decoration: none;
         }
    .forgot-password:hover, .create-account:hover, .back-to-login:hover 
    { text-decoration: underline; 
        color: #00aaff; 
    }
    .error-message {
        color: #ff6347; /* Cor vermelha para erros */
        font-size: 16px; /* Ajuste o tamanho da fonte, se necess치rio */
        margin-bottom: 10px;
        text-align: left;
        font-family: Verdana, sans-serif;
        display: block; /* Garante que o erro ser치 exibido como um bloco */
    }
    .error-input { border: 1px solid #ff6347; }
    .checkbox-container { display: flex; flex-direction: row; align-items: center; font-size: 14px; color: #E0FFFF; margin-top: 10px; }
    .checkbox-container label { margin-right: 10px; }
    .checkbox-container input { margin-right: 5px; }
    input[type="text"], input[type="password"], input[type="email"] {
        width: 100%; 
        padding: 14px; 
        margin: 10px 0; 
        border: 1px solid #b3dae4; 
        border-radius: 8px; 
        background-color: #8ed2e4; 
        color: #ffffff; 
        font-size: 18px; 
    }

    input[type="text"]::placeholder, input[type="password"]::placeholder, input[type="email"]::placeholder {
        color: #000;
    }
            .title { 
     color: #ffffff; /* branco puro */
text-shadow: 
    0 0 10px rgba(255, 255, 255, 1),
    0 0 20px rgba(0, 191, 255, 0.8),
    0 0 35px rgba(0, 191, 255, 0.7),
    0 0 50px rgba(0, 191, 255, 0.6);
    font-size: 19vw;
    font-weight: bold; 
    z-index: 2;
    top: -100000px;
}
        

    </style>
</head>
<body>

   <div class="login-container">
 <h1 class="title">TecWorld</h1>

 <form id="login-form" class="invisible" onsubmit="return validateForm(event)">
        <!-- Conte칰do ser치 gerado dinamicamente pelo JavaScript -->
    </form>
</div>

    </div>
     <!-- Firebase App (necess치rio) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<!-- Firebase Auth -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<!-- Firebase Firestore -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<!-- Inicializa o Firebase -->
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyA-xYnpBxH7ut_aZoBJKWwkGBY9QVB5bY0",
    authDomain: "nexworld-1-235bf.firebaseapp.com",
    projectId: "nexworld-1-235bf",
    storageBucket: "nexworld-1-235bf.firebasestorage.app",
    messagingSenderId: "829828361946",
    appId: "1:829828361946:web:6c13a0884d4b0d2829bfe3",
    measurementId: "G-6M6M7MNR2E"
  };

  firebase.initializeApp(firebaseConfig);
</script>
  <script>
    
    let currentLanguage = 'pt'; // Idioma padr칚o

// Fun칞칚o para alterar o idioma
function changeLanguage(lang) {
    localStorage.setItem('selectedLanguage', lang); // Salva o idioma
    currentLanguage = lang;
    showLogin(); // Atualiza os textos na p치gina de login
}

// Evento DOMContentLoaded para carregar o idioma salvo e exibir a p치gina de login
document.addEventListener('DOMContentLoaded', () => {
    const savedLanguage = localStorage.getItem('selectedLanguage') || 'pt'; // Recupera ou usa o idioma padr칚o
    currentLanguage = savedLanguage;

    // Exibe a p치gina de login imediatamente com o idioma correto
    showLogin(); 
});

// Fun칞칚o para exibir e traduzir a p치gina de login
function showLogin() {
    const t = translations[currentLanguage]; // Obt칠m as tradu칞칫es para o idioma selecionado
    const loginForm = document.getElementById('login-form');
    if (loginForm) {
    loginForm.innerHTML = `
                   <h1>${t.heading}</h1>
            <input type="text" id="email" placeholder="${t.emailPlaceholder}">
            <input type="password" id="password" placeholder="${t.passwordPlaceholder}">
            <div id="general-error" class="error-message"></div>
            <button type="button" class="login-btn" onclick="login()">${t.loginButton}</button>
            <a href="#" class="forgot-password" onclick="showForgotPassword()">${t.forgotPassword}</a>
            <a href="#" class="create-account" onclick="showCreateAccount()">${t.createAccount}</a>
        `;

}


}


const translations = {
    pt: {
        heading: "Entrar",
        emailPlaceholder: "Email ",
        passwordPlaceholder: "Senha",
        loginButton: "Entrar",
        forgotPassword: "Esqueceu a senha?",
        createAccount: "Criar Conta",
        recoverHeading: "Recuperar Senha",
        recoverButton: "Recuperar",
        createHeading: "Criar Conta",
        createUsernamePlaceholder: "Nome de usu치rio",
        createEmailPlaceholder: "Email",
        createPasswordPlaceholder: "Senha",
        createTerms: "Aceito os <a href='termos.html' target='_blank'>Termos de Uso</a>",
        createPrivacy: "Aceito a <a href='privacidade.html' target='_blank'>Pol칤tica de Privacidade</a>",
        createRegister: "Cadastrar",
        backToLogin: "J치 tem conta? Entrar",
        generalError: "Por favor, preencha todos os campos solicitados.",
        invalidEmail: "Por favor, insira um email v치lido (Gmail, Outlook, Yahoo Mail, Apple Mail, ProtonMail, Zoho Mail).",
        invalidPassword: "A senha deve ter mais de 5 caracteres.",
        termsError: "Voc칡 precisa aceitar os Termos de Uso e a Pol칤tica de Privacidade.",
        firebaseErrors: {
            "auth/invalid-email": "Email inv치lido.",
            "auth/user-disabled": "Usu치rio desativado.",
            "auth/user-not-found": "Usu치rio n칚o encontrado.",
            "auth/wrong-password": "Senha incorreta.",
            "auth/email-already-in-use": "Este email j치 est치 em uso.",
            "auth/weak-password": "A senha 칠 muito fraca.",
            "auth/too-many-requests": "Muitas tentativas. Tente novamente mais tarde.",
            "auth/network-request-failed": "Erro de rede. Verifique sua conex칚o."
        }
    },
    en: {
        heading: "Log In",
        emailPlaceholder: "Email ",
        passwordPlaceholder: "Password",
        loginButton: "Login",
        forgotPassword: "Forgot password?",
        createAccount: "Create Account",
        recoverHeading: "Recover Password",
        recoverButton: "Recover",
        createHeading: "Create Account",
        createUsernamePlaceholder: "Username",
        createEmailPlaceholder: "Email",
        createPasswordPlaceholder: "Password",
        createTerms: "I accept the <a href='terms.html' target='_blank'>Terms of Use</a>",
        createPrivacy: "I accept the <a href='privacy.html' target='_blank'>Privacy Policy</a>",
        createRegister: "Register",
        backToLogin: "Already have an account? Login",
        generalError: "Please fill in all required fields.",
        invalidEmail: "Please enter a valid email (Gmail, Outlook, Yahoo Mail, Apple Mail, ProtonMail, Zoho Mail).",
        invalidPassword: "Password must be more than 5 characters.",
        termsError: "You must accept the Terms of Use and Privacy Policy.",
        firebaseErrors: {
            "auth/invalid-email": "Invalid email.",
            "auth/user-disabled": "User disabled.",
            "auth/user-not-found": "User not found.",
            "auth/wrong-password": "Incorrect password.",
            "auth/email-already-in-use": "Email already in use.",
            "auth/weak-password": "Password is too weak.",
            "auth/too-many-requests": "Too many requests. Try again later.",
            "auth/network-request-failed": "Network error. Check your connection."
        }
    },
    es: {
        heading: "Iniciar sesi칩n",
        emailPlaceholder: "Correo electr칩nico ",
        passwordPlaceholder: "Contrase침a",
        loginButton: "Iniciar sesi칩n",
        forgotPassword: "쯆lvidaste tu contrase침a?",
        createAccount: "Crear Cuenta",
        recoverHeading: "Recuperar Contrase침a",
        recoverButton: "Recuperar",
        createHeading: "Crear Cuenta",
        createUsernamePlaceholder: "Nombre de usuario",
        createEmailPlaceholder: "Correo electr칩nico",
        createPasswordPlaceholder: "Contrase침a",
        createTerms: "Acepto los <a href='terminos.html' target='_blank'>T칠rminos de Uso</a>",
        createPrivacy: "Acepto la <a href='privacidad.html' target='_blank'>Pol칤tica de Privacidad</a>",
        createRegister: "Registrar",
        backToLogin: "쯏a tienes cuenta? Iniciar sesi칩n",
        generalError: "Por favor, complete todos los campos requeridos.",
        invalidEmail: "Por favor, ingresa un correo electr칩nico v치lido (Gmail, Outlook, Yahoo Mail, Apple Mail, ProtonMail, Zoho Mail).",
        invalidPassword: "La contrase침a debe tener m치s de 5 caracteres.",
        termsError: "Debes aceptar los T칠rminos de Uso y la Pol칤tica de Privacidad.",
        firebaseErrors: {
            "auth/invalid-email": "Correo electr칩nico inv치lido.",
            "auth/user-disabled": "Usuario deshabilitado.",
            "auth/user-not-found": "Usuario no encontrado.",
            "auth/wrong-password": "Contrase침a incorrecta.",
            "auth/email-already-in-use": "Este correo ya est치 en uso.",
            "auth/weak-password": "La contrase침a es demasiado d칠bil.",
            "auth/too-many-requests": "Demasiados intentos. Intente m치s tarde.",
            "auth/network-request-failed": "Error de red. Verifique su conexi칩n."
        }
    }
};



        
// Fun칞칚o para criar conta usando Firebase + confirma칞칚o de senha
async function saveAccount() {
    const errorMessage = document.getElementById('general-error');
    const t = translations[currentLanguage];

    // Verifica se os elementos existem
    const usernameInput = document.getElementById('username');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const confirmInput = document.getElementById('confirm-password');
    const termsCheckbox = document.getElementById('terms');
    const privacyCheckbox = document.getElementById('privacy');

    if (!usernameInput || !emailInput || !passwordInput || !confirmInput || !termsCheckbox || !privacyCheckbox) {
        errorMessage.innerHTML = 'Erro interno: elementos de formul치rio n칚o encontrados.';
        errorMessage.style.display = 'block';
        return;
    }

    // Pegando valores
    const username = usernameInput.value.trim();
    const email = emailInput.value.trim();
    const password = passwordInput.value.trim();
    const confirmPassword = confirmInput.value.trim();
    const terms = termsCheckbox.checked;
    const privacy = privacyCheckbox.checked;

    // Valida칞칚o de campos vazios
    if (!username || !email || !password || !confirmPassword || !terms || !privacy) {
        errorMessage.innerHTML = t.generalError || "Preencha todos os campos.";
        errorMessage.style.display = 'block';
        return;
    }

    // Confirma칞칚o da senha
    if (password !== confirmPassword) {
        errorMessage.innerHTML = "As senhas n칚o coincidem.";
        errorMessage.style.display = 'block';
        return;
    }

    // Dom칤nios permitidos
    const validDomains = /@(gmail\.com|outlook\.com|yahoo\.com|aol\.com|icloud\.com|protonmail\.com|zoho\.com)$/i;
    if (!validDomains.test(email)) {
        errorMessage.innerHTML = t.invalidEmail;
        errorMessage.style.display = 'block';
        return;
    }

    // Senha m칤nima
    if (password.length < 6) {
        errorMessage.innerHTML = t.invalidPassword || "A senha deve ter pelo menos 6 caracteres.";
        errorMessage.style.display = 'block';
        return;
    }

    // ---------------------------
    //        CRIAR CONTA
    // ---------------------------
    try {
        const res = await fetch("http://localhost:3000/create-user", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, password, username })
        });

        const data = await res.json();
        if (!res.ok) throw new Error(data.message);

        // Salva informa칞칫es no navegador
        localStorage.setItem("email", email);
        localStorage.setItem("userId", data.sequentialId);

        window.location.href = "inicial.html";

    } catch (error) {
        let msg = error.message;

        // Tradu칞칚o exata por c칩digo vindo do backend
        if (t.firebaseErrors[msg]) {
            msg = t.firebaseErrors[msg];
        }

        // Tradu칞칚o por parte da mensagem enviada pelo Firebase
        if (msg.includes("already in use")) {
            msg = t.firebaseErrors["auth/email-already-in-use"];
        }
        if (msg.includes("invalid-email")) {
            msg = t.firebaseErrors["auth/invalid-email"];
        }
        if (msg.includes("weak-password")) {
            msg = t.firebaseErrors["auth/weak-password"];
        }

        errorMessage.innerHTML = msg;
        errorMessage.style.display = "block";
    }
}


function showCreateAccount() {
    const t = translations[currentLanguage];
    const loginForm = document.getElementById('login-form');

    if (loginForm) {
        loginForm.innerHTML = `
            <h1>${t.createHeading}</h1>

            <input type="text" placeholder="${t.createUsernamePlaceholder}" id="username">
            <input type="text" placeholder="${t.createEmailPlaceholder}" id="email">
            <input type="password" placeholder="${t.createPasswordPlaceholder}" id="password">
            <!-- Campo que faltava -->
            <input type="password" placeholder="Confirmar senha" id="confirm-password">

            <div class="checkbox-container">
                <input type="checkbox" id="terms">
                <label for="terms">${t.createTerms}</label>
            </div>

            <div class="checkbox-container">
                <input type="checkbox" id="privacy">
                <label for="privacy">${t.createPrivacy}</label>
            </div>

            <div id="general-error" class="error-message"></div>

            <button type="button" class="login-btn" onclick="saveAccount()">
                ${t.createRegister}
            </button>

            <a href="#" class="back-to-login" onclick="showLogin()">
                ${t.backToLogin}
            </a>
        `;

        // Reinsere o seletor de idioma no topo se existir
        const select = document.querySelector('select');
        if (select) {
            loginForm.insertBefore(select, loginForm.firstChild);
        }
    }
}


// Fun칞칚o para exibir o formul치rio de recupera칞칚o de senha
function showForgotPassword() {
    const t = translations[currentLanguage];
    const loginForm = document.getElementById('login-form');
    if (loginForm) {
        loginForm.innerHTML = ` 
            <h1>${t.recoverHeading}</h1>
            <input type="email" placeholder="${t.emailPlaceholder}" id="email">
            <button type="button" class="login-btn" onclick="recoverPassword()">${t.recoverButton}</button>
            <a href="#" class="back-to-login" onclick="showLogin()">${t.backToLogin}</a>
        `;
        const select = document.querySelector('select');
        if (select) loginForm.insertBefore(select, loginForm.firstChild);
    }
}
async function login() {
    const t = translations[currentLanguage];
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value.trim();
    const errorMessage = document.getElementById("general-error");

    errorMessage.style.display = "none";

    if (!email || !password) {
        errorMessage.innerHTML = t.generalError;
        errorMessage.style.display = "block";
        return;
    }

    try {
        const res = await fetch("http://localhost:3000/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ identifier: email, password })
        });

        const data = await res.json();

        if (!res.ok) {
            errorMessage.innerHTML = data.error || t.firebaseErrors["auth/wrong-password"];
            errorMessage.style.display = "block";
            return;
        }

        // 游댠 LOGIN OK
        localStorage.setItem("uid", data.uid);
        localStorage.setItem("email", email);

        window.location.href = "inicial.html";

    } catch (err) {
        errorMessage.innerHTML = "Erro ao conectar ao servidor.";
        errorMessage.style.display = "block";
    }
}



// Fun칞칚o de recupera칞칚o de senha usando Firebase
async function recoverPassword() {
    const email = document.getElementById('email').value.trim();
    const t = translations[currentLanguage];
    if (!email) {
        alert(t.invalidEmail || 'Por favor, insira um e-mail v치lido.');
        return;
    }
    try {
        await firebase.auth().sendPasswordResetEmail(email);
        alert(t.recoverPasswordSent || 'E-mail de recupera칞칚o enviado!');
    } catch (error) {
        alert(error.message || 'Erro ao enviar o e-mail de recupera칞칚o.');
    }
}

// Fun칞칚o para exibir o formul치rio de cria칞칚o de conta



 </script>
 </body>
</html>
