<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TecWorld - Redefinir Senha</title>
<style>
/* ... seu CSS permanece igual ... */
</style>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js" defer></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js" defer></script>
</head>
<body>
<div class="container">
    <div class="invalid-overlay" id="invalidOverlay">
        <h1>Link inválido</h1>
        <p>Este link expirou ou não é válido.</p>
    </div>

    <h1 class="title">TecWorld</h1>
    <h2>Redefinir senha</h2>

    <div class="input-group">
        <label>Nova senha</label>
        <input type="password" id="newPass">
    </div>
    <div class="input-group">
        <label>Confirmar senha</label>
        <input type="password" id="confirmPass">
    </div>

    <button id="resetBtn">Alterar</button>

    <div class="error" id="errorBox"></div>
    <div class="success" id="successBox"></div>
</div>

<script defer>
document.addEventListener("DOMContentLoaded", () => {
    const firebaseConfig = {
        apiKey: "AIzaSyA-xYnpBxH7ut_aZoBJKWwkGBY9QVB5bY0",
        authDomain: "nexworld-1-235bf.firebaseapp.com",
        projectId: "nexworld-1-235bf",
        storageBucket: "nexworld-1-235bf.firebasestorage.app",
        messagingSenderId: "829828361946",
        appId: "1:829828361946:web:6c13a0884d4b0d2829bfe3"
    };

    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    const urlParams = new URLSearchParams(window.location.search);
    const oobCode = urlParams.get("oobCode");

    const newPassInput = document.getElementById("newPass");
    const confirmPassInput = document.getElementById("confirmPass");
    const btn = document.getElementById("resetBtn");
    const errorBox = document.getElementById("errorBox");
    const successBox = document.getElementById("successBox");
    const overlay = document.getElementById("invalidOverlay");

    if (!oobCode) {
        overlay.style.display = "flex";
        newPassInput.disabled = true;
        confirmPassInput.disabled = true;
        btn.disabled = true;
        newPassInput.style.opacity = "0.5";
        confirmPassInput.style.opacity = "0.5";
        btn.style.opacity = "0.4";
        btn.style.cursor = "not-allowed";
    }

    btn.addEventListener("click", async () => {
        if (!oobCode) return;

        const newPass = newPassInput.value.trim();
        const confirmPass = confirmPassInput.value.trim();
        errorBox.style.display = "none";
        successBox.style.display = "none";

        if (newPass.length < 6) {
            errorBox.innerHTML = "A senha deve ter pelo menos 6 caracteres.";
            errorBox.style.display = "block";
            return;
        }
        if (newPass !== confirmPass) {
            errorBox.innerHTML = "As senhas não coincidem.";
            errorBox.style.display = "block";
            return;
        }

        try {
            await auth.confirmPasswordReset(oobCode, newPass);
            successBox.innerHTML = "Senha redefinida com sucesso! Redirecionando...";
            successBox.style.display = "block";
            setTimeout(() => window.location.href = "login.html", 2500);
        } catch (error) {
            if (error.code === "auth/expired-action-code" || error.code === "auth/invalid-action-code") {
                overlay.style.display = "flex";
                newPassInput.disabled = true;
                confirmPassInput.disabled = true;
                btn.disabled = true;
                btn.style.opacity = "0.4";
                btn.style.cursor = "not-allowed";
            } else {
                errorBox.innerHTML = "Erro: " + error.message;
                errorBox.style.display = "block";
            }
        }
    });
});
</script>
</body>
</html>
